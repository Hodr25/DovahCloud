{% extends "base.html" %}
{% block titulo %}Detalle del archivo{% endblock %}

{% block contenido %}
<div class="detalle-container">

  <!-- Vista previa del archivo -->
  <div class="archivo-preview" style="text-align: center">
    {% if archivo.es_privado and not session.get('acceso_privado') %}
      <p><strong>üîí Este archivo es privado. Inicia sesi√≥n en la zona segura para visualizarlo.</strong></p>
    {% else %}
      {% if archivo.tipo.startswith('image/') %}
        <a href="/media/{{ archivo.nombre }}" target="_blank">
          <img src="/media/thumb_{{ archivo.nombre }}" alt="Vista previa" style="max-width: 100%; border: 1px solid #444;">
        </a>
        <p><small>Clic para ver en tama√±o completo</small></p>

      {% elif archivo.tipo.startswith('video/') %}
        <video width="100%" controls>
          <source src="/media/{{ archivo.nombre }}" type="{{ archivo.tipo }}">
          Tu navegador no puede reproducir este v√≠deo.
        </video>

        {% set mp3 = archivo.nombre.rsplit('.', 1)[0] ~ '.mp3' %}
        {% if mp3 in archivos_en_media %}
          <p><a href="/media/{{ mp3 }}">üéß Descargar solo audio</a></p>
        {% endif %}

      {% elif archivo.tipo.startswith('audio/') %}
        <audio controls style="width:100%;">
          <source src="/media/{{ archivo.nombre }}" type="{{ archivo.tipo }}">
          Tu navegador no puede reproducir este audio.
        </audio>

      {% elif archivo.tipo == 'application/pdf' %}
        <iframe src="/media/{{ archivo.nombre }}" width="100%" height="600px" style="border:1px solid #555;"></iframe>
        <p><small><a href="/media/{{ archivo.nombre }}" target="_blank">üìÑ Ver en otra pesta√±a</a></small></p>

      {% else %}
        <p>No hay vista previa disponible para este tipo de archivo.</p>
        {% set pdf = archivo.nombre.rsplit('.', 1)[0] ~ '.pdf' %}
        {% if pdf in archivos_en_media %}
          <p><a href="/media/{{ pdf }}">üìÑ Descargar versi√≥n PDF convertida</a></p>
        {% endif %}
      {% endif %}
    {% endif %}
  </div>

  <!-- Panel de detalles del archivo -->
        <h2 style="text-align: center">{{ archivo.nombre }}</h2>
  <div style="text-align: center">
    <ul class="archivo-meta" style="list-style: none;">
      <li><strong>Tama√±o:</strong> {{ archivo.tama√±o | filesizeformat }}</li>
      <li><strong>Tipo:</strong> {{ archivo.tipo }}</li>
      <li><strong>Subido el:</strong> {{ archivo.fecha_subida.strftime('%d/%m/%Y %H:%M') }}</li>
      <li><strong>SHA256:</strong> {{ archivo.hash_archivo or '‚Äî' }}</li>
      <li><strong>Etiquetas:</strong>
        {% if archivo.etiquetas %}
          {% for etiqueta in archivo.etiquetas %}
            <a href="/buscar?etiqueta={{ etiqueta.nombre }}">{{ etiqueta.nombre }}</a>{% if not loop.last %}, {% endif %}
          {% endfor %}
        {% else %}
          <em>Sin etiquetas</em>
        {% endif %}
      </li>
    </ul>
  </div>

    <div class="acciones" style="text-align: center">
      <a href="/favoritos/agregar/{{ archivo.id }}">‚≠ê Agregar a favoritos</a> |
      <a href="/editar/{{ archivo.id }}">‚úèÔ∏è Editar etiquetas</a> |
      <a href="/descargar/{{ archivo.id }}">‚¨áÔ∏è Descargar</a> |
      <a href="/eliminar/{{ archivo.id }}" style="color:red;">‚ùå Eliminar</a>
    </div>
  </div>
</div>

<!-- Secci√≥n de descripci√≥n -->
<div class="descripcion-ampliada" style="text-align: center">
  <h3>üìù Descripci√≥n</h3>
  {% if session.get('acceso_privado') %}
    <form action="/archivo/{{ archivo.id }}/editar_descripcion" method="POST">
      <textarea name="descripcion" id="descripcion" rows="4" style="width:100%;">{{ archivo.descripcion or '' }}</textarea><br>
      <button type="submit">üíæ Guardar descripci√≥n</button>
    </form>
  {% elif archivo.descripcion %}
    <p>{{ archivo.descripcion }}</p>
  {% else %}
    <p><em>No hay descripci√≥n disponible.</em></p>
  {% endif %}
</div>
{% endblock %}
